name: CI
on:
  pull_request:
    branches:
      - master
  push:
    branches:
      - master
      - staging
      - trying
    tags: '*'
  workflow_dispatch:
jobs:
  test:
    name: Julia ${{ matrix.version }} - ${{ matrix.os }} - ${{ matrix.arch }} - ${{ github.event_name }}
    runs-on: ${{ matrix.os }}
    timeout-minutes: 60
    strategy:
      fail-fast: false
      matrix:
        os:
          - ubuntu-latest
    steps:
      - uses: actions/checkout@v2
        with:
          fetch-depth: 0
      - run: git config --global user.name "Dilum Aluthge"
      - run: git config --global user.email "dilum@aluthge.com"
      - run: rm -rf /tmp/julia
      - run: mkdir -p /tmp
      - run: cd /tmp && git clone https://github.com/JuliaLang/julia.git
      - run: cd /tmp/julia && git checkout jn/no-half-duplex
      - run: cd /tmp/julia && git log -n 1
      - run: cd /tmp/julia && make -j2
      - run: cd /tmp/julia && make install
      - run: echo "/tmp/julia/usr/bin" >> $GITHUB_PATH
      - run: which -a julia
      - run: which julia
      - run: julia --version
      - run: julia -e 'using InteractiveUtils; InteractiveUtils.versioninfo(; verbose = true)'
      - uses: julia-actions/julia-buildpkg@v1
      - uses: julia-actions/julia-runtest@v1
        env:
          JULIA_DEBUG: 'all'
          BUMPSTDLIBS_TOKEN_FOR_TESTS: ${{ secrets.BUMPSTDLIBS_TOKEN_FOR_TESTS }}
